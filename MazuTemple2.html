<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>線上靈籤 | 天后宮 & 黃大仙 (完整典藏版)</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React (CDN) + Babel (in-browser compile) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom-client.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&display=swap');
    body { font-family: 'Noto Serif TC', serif; background-color: #292524; color: #fef3c7; }
    .backface-hidden { backface-visibility: hidden; }
    .transform-style-3d { transform-style: preserve-3d; }
    .writing-vertical { writing-mode: vertical-rl; }
    @media (max-width: 768px) {
      /* Mobile readability: avoid forced vertical writing on small screens */
      .writing-vertical { writing-mode: horizontal-tb; }
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in { animation: fadeIn .5s ease-out forwards; }

    /* Moon block toss animations: slightly slower for more "ritual" pacing */
    @keyframes toss-left {
      0%   { transform: translateY(0) rotateX(0) rotateZ(0); }
      50%  { transform: translateY(-135px) rotateX(720deg) rotateZ(-30deg); }
      100% { transform: translateY(0) rotateX(var(--rotate-end-left)) rotateZ(15deg); }
    }
    @keyframes toss-right {
      0%   { transform: translateY(0) rotateX(0) rotateZ(0); }
      50%  { transform: translateY(-135px) rotateX(720deg) rotateZ(30deg); }
      100% { transform: translateY(0) rotateX(var(--rotate-end-right)) rotateZ(-15deg); }
    }
    .animate-toss-left  { animation: toss-left 1.7s ease-out forwards; }
    .animate-toss-right { animation: toss-right 1.7s ease-out forwards; }

    /* Shake (筒身搖晃) */
    @keyframes container-shake {
      0%, 100% { transform: rotate(0deg); }
      25%      { transform: rotate(-4deg) translateY(-4px); }
      75%      { transform: rotate(4deg) translateY(-4px); }
    }
    .animate-shake-hard { animation: container-shake 0.12s infinite; }

    /* Simple focus ring on keyboard nav */
    :focus-visible {
      outline: 3px solid rgba(245, 158, 11, 0.65);
      outline-offset: 3px;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useEffect, useMemo, useRef, useState } = React;

    const STEPS = {
      SELECT_DEITY: 0,
      INTRO: 1,
      INPUT: 2,
      ASK_PERMISSION: 3,
      SHAKING: 4,
      PICK_LOT: 5,
      CONFIRM_LOT: 6,
      AI_ANALYZING: 7,
      RESULT: 8
    };

    // --- 媽祖六十甲子籤資料庫 ---
    const MAZU_LOTS = [
            {id:1,t:'甲子',l:'大吉',s:'包公請雷驚仁宗',p:['日出便見風雲散','光明清淨照世間','一向前途通大道','萬事清吉保平安'],j:{'功名':'顯榮','月令':'月圓','婚姻':'成者','財利':'十分','治病':'痊癒','尋人':'得回','官事':'有理','家運':'平安'}},
            {id:2,t:'甲寅',l:'中吉',s:'於今此景正當時',p:['於今此景正當時','看看欲吐百花魁','若能遇得春色到','一灑清吉脫塵埃'],j:{'功名':'有貴','月令':'平平','婚姻':'和合','財利':'晚成','治病':'春癒','尋人':'南方','官事':'勝訴','家運':'漸興'}},
            {id:3,t:'甲辰',l:'中吉',s:'朱德武入寺相分明',p:['勸君把定心莫虛','天註衣祿自有餘','和合重重常吉慶','時來終遇得明珠'],j:{'功名':'後科','月令':'漸好','婚姻':'大吉','財利':'有','治病':'安','尋人':'見','官事':'吉','家運':'安'}},
            {id:4,t:'甲午',l:'中平',s:'盧龍王次子招親',p:['風恬浪靜可行舟','恰是中秋月一輪','凡事不須多憂慮','福祿自有慶家門'],j:{'功名':'有','月令':'好','婚姻':'合','財利':'有','治病':'癒','尋人':'至','官事':'和','家運':'隆'}},
            {id:5,t:'甲申',l:'中平',s:'龐統遇難',p:['只恐前途命有變','勸君作急可宜先','且守長江無大事','命逢太白守身邊'],j:{'功名':'難','月令':'變','婚姻':'變','財利':'無','治病':'險','尋人':'杳','官事':'凶','家運':'變'}},
            {id:6,t:'甲戌',l:'中平',s:'孔明出師',p:['風雲致雨落洋洋','天災時氣必有傷','命內此事難和合','更逢一足出外鄉'],j:{'功名':'無','月令':'凶','婚姻':'不合','財利':'無','治病':'險','尋人':'杳','官事':'虧','家運':'不寧'}},
            {id:7,t:'乙丑',l:'下下',s:'孟姜女送寒衣',p:['雲開月出正分明','不須進退問前程','婚姻皆由天註定','和合清吉萬事成'],j:{'功名':'無望','月令':'淡淡','婚姻':'不吉','財利':'微薄','治病':'拖延','尋人':'難見','官事':'和解','家運':'守成'}},
            {id:8,t:'乙卯',l:'中平',s:'孫悟空大難火災',p:['禾稻看看結成完','此事必定兩相全','回到家中寬心坐','妻兒鼓舞樂團圓'],j:{'功名':'少','月令':'中平','婚姻':'合','財利':'平','治病':'安','尋人':'見','官事':'拖','家運':'團圓'}},
            {id:9,t:'乙巳',l:'下籤',s:'龍虎相隨在深山',p:['龍虎相隨在深山','君爾何須背後看','不知身在千山外','直待虎頭人看版'],j:{'功名':'阻','月令':'平','婚姻':'隨緣','財利':'微','治病':'求神','尋人':'難','官事':'和','家運':'祈福'}},
            {id:10,t:'乙未',l:'中吉',s:'李旦龍鳳配',p:['花開結子一半枯','可惜今年汝虛度','漸漸日落西山去','勸君不用向前途'],j:{'功名':'難','月令':'難','婚姻':'不合','財利':'無','治病':'險','尋人':'無','官事':'凶','家運':'不順'}},
            {id:11,t:'乙酉',l:'上吉',s:'韓信拜將',p:['靈雞漸漸見分明','凡事且看子丑寅','雲開月出照天下','郎君即便見太平'],j:{'功名':'顯','月令':'吉','婚姻':'成','財利':'有','治病':'癒','尋人':'至','官事':'勝','家運':'隆'}},
            {id:12,t:'乙亥',l:'上吉',s:'薛仁貴投軍',p:['長江風浪漸漸靜','于今得進可安寧','比下月下言人少','只恐前途命有窮'],j:{'功名':'顯','月令':'吉','婚姻':'成','財利':'有','治病':'癒','尋人':'至','官事':'勝','家運':'隆'}},
            {id:13,t:'丙子',l:'下下',s:'郭華醉酒誤佳期',p:['命內正逢羅孛關','用盡心機總未休','作福問神難得過','恰是行舟上高灘'],j:{'功名':'無','月令':'不吉','婚姻':'不吉','財利':'失','治病':'險','尋人':'杳','官事':'虧','家運':'不寧'}},
            {id:14,t:'丙寅',l:'中平',s:'劉備入蜀',p:['財中漸漸見分明','花開花謝結子成','寬心且看月中桂','郎君即便見太平'],j:{'功名':'顯','月令':'漸好','婚姻':'成','財利':'有','治病':'安','尋人':'至','官事':'吉','家運':'平'}},
            {id:15,t:'丙辰',l:'上吉',s:'楊六郎斬子',p:['八十原來是太公','看看晚景遇文王','目下緊事休相問','勸君且守待運通'],j:{'功名':'晚','月令':'平','婚姻':'平','財利':'晚','治病':'老癒','尋人':'慢','官事':'吉','家運':'平'}},
            {id:16,t:'丙午',l:'平吉',s:'李世民遊地府',p:['不須作福不須求','用盡心機總未休','陽世不知陰世事','官法如爐不自由'],j:{'功名':'難','月令':'不順','婚姻':'不合','財利':'無','治病':'險','尋人':'無','官事':'凶','家運':'不順'}},
            {id:17,t:'丙申',l:'上吉',s:'寇準背靴',p:['舊恨重重未改為','家中禍患不臨身','須當謹防宜作福','龍蛇交會得和合'],j:{'功名':'顯','月令':'吉','婚姻':'成','財利':'有','治病':'安','尋人':'至','官事':'勝','家運':'隆'}},
            {id:18,t:'丙戌',l:'中平',s:'曹操遇華容道',p:['君問中間此言因','看看祿馬拱前程','若得貴人多得利','和合自有兩分明'],j:{'功名':'有','月令':'平','婚姻':'成','財利':'有','治病':'癒','尋人':'見','官事':'吉','家運':'安'}},
            {id:19,t:'丁丑',l:'上上',s:'韓信築壇拜將',p:['富貴由命天註定','心高必然誤君期','不然且回依舊路','雲開月出自分明'],j:{'功名':'顯','月令':'吉','婚姻':'成','財利':'有','治病':'癒','尋人':'至','官事':'勝','家運':'隆'}},
            {id:20,t:'丁卯',l:'中吉',s:'蘇武牧羊',p:['前途功名未得意','只恐命內運未通','兩家深利同合意','湧身解此月中風'],j:{'功名':'通','月令':'吉','婚姻':'合','財利':'有','治病':'安','尋人':'見','官事':'吉','家運':'順'}},
            {id:21,t:'丁巳',l:'中平',s:'薛仁貴回家',p:['十方佛法有靈通','大難禍患不相同','紅日當空常照耀','還有貴人到家堂'],j:{'功名':'望','月令':'平','婚姻':'合','財利':'平','治病':'癒','尋人':'見','官事':'和','家運':'安'}},
            {id:22,t:'丁未',l:'中吉',s:'曹操賜雲長馬袍',p:['太公家業八十成','月出光輝四海明','命內自然逢大吉','茅屋中間百事亨'],j:{'功名':'有','月令':'吉','婚姻':'成','財利':'利','治病':'安','尋人':'至','官事':'可','家運':'平'}},
            {id:23,t:'丁酉',l:'下下',s:'周瑜病亡',p:['欲去長江水闊茫','行舟把定未遭風','戶內用心再作福','看看魚水得相逢'],j:{'功名':'顯','月令':'吉','婚姻':'成','財利':'有','治病':'安','尋人':'至','官事':'勝','家運':'隆'}},
            {id:24,t:'丁亥',l:'中吉',s:'竇娥冤',p:['月出光輝本清吉','浮雲總是蔽陰色','戶內用心再作福','當官分理便有益'],j:{'功名':'無','月令':'平','婚姻':'平','財利':'平','治病':'險','尋人':'難','官事':'和','家運':'安'}},
            {id:25,t:'戊子',l:'下下',s:'李世民落海灘',p:['總是前途莫心勞','求神問聖枉是多','但看雞犬日過後','不須作福事如何'],j:{'功名':'難','月令':'凶','婚姻':'凶','財利':'無','治病':'險','尋人':'杳','官事':'凶','家運':'衰'}},
            {id:26,t:'戊寅',l:'上上',s:'李白醉酒撈月',p:['選出牡丹第一枝','勸君折取莫遲疑','世間若問相知處','萬事逢春正及時'],j:{'功名':'顯','月令':'吉','婚姻':'成','財利':'有','治病':'癒','尋人':'至','官事':'勝','家運':'隆'}},
            {id:27,t:'戊辰',l:'中吉',s:'石崇被難',p:['君爾寬心且自由','門庭清吉家無憂','財寶自然終吉利','凡事無傷不用求'],j:{'功名':'守','月令':'平','婚姻':'平','財利':'無','治病':'求神','尋人':'難','官事':'和','家運':'守'}},
            {id:28,t:'戊午',l:'中平',s:'孔明大戰馬謖',p:['於今莫作此當時','虎落平陽被犬欺','世間凡事何難定','千山萬水也遲疑'],j:{'功名':'顯','月令':'吉','婚姻':'成','財利':'有','治病':'癒','尋人':'見','官事':'吉','家運':'慶'}},
            {id:29,t:'戊申',l:'中吉',s:'范少伯泛舟',p:['枯木可惜未逢春','如今還在暗中藏','寬心且守風霜退','還君依舊作乾坤'],j:{'功名':'顯','月令':'吉','婚姻':'成','財利':'有','治病':'癒','尋人':'至','官事':'勝','家運':'隆'}},
            {id:30,t:'戊戌',l:'中平',s:'包公問郭槐',p:['漸漸看此月中和','過後須防未得高','改變顏色前途去','凡事必定見重勞'],j:{'功名':'無','月令':'平','婚姻':'平','財利':'平','治病':'險','尋人':'難','官事':'和','家運':'安'}},
            {id:31,t:'己丑',l:'上吉',s:'劉智遠得岳氏',p:['綠柳蒼蒼正當時','任君此去作乾坤','花果結實無殘謝','福祿自有慶家門'],j:{'功名':'顯','月令':'平','婚姻':'成','財利':'有','治病':'安','尋人':'至','官事':'吉','家運':'順'}},
            {id:32,t:'己卯',l:'中吉',s:'薛丁山著飛刀',p:['龍虎相交在門前','此事必定兩相連','黃金忽然變成鐵','何用作福問神仙'],j:{'功名':'有','月令':'平','婚姻':'合','財利':'平','治病':'癒','尋人':'見','官事':'和','家運':'安'}},
            {id:33,t:'己巳',l:'中平',s:'李旦龍鳳配',p:['欲去長江水闊茫','行舟把定未遭風','戶內用心再作福','看看魚水得相逢'],j:{'功名':'望','月令':'平','婚姻':'合','財利':'有','治病':'癒','尋人':'見','官事':'和','家運':'安'}},
            {id:34,t:'己未',l:'下下',s:'姜太公八十遇文王',p:['危險高山行過盡','莫嫌此路有重重','若見蘭桂漸漸發','去蛇反轉變成龍'],j:{'功名':'晚','月令':'平','婚姻':'平','財利':'晚','治病':'老癒','尋人':'慢','官事':'吉','家運':'平'}},
            {id:35,t:'己酉',l:'上吉',s:'李靖歸山',p:['此事何須用心機','前途變怪自然知','看看此去得和合','漸漸脫出見太平'],j:{'功名':'有','月令':'平','婚姻':'合','財利':'有','治病':'安','尋人':'見','官事':'和','家運':'安'}},
            {id:36,t:'己亥',l:'中平',s:'蘇東坡遊江',p:['福如東海壽如山','君爾何須嘆苦難','命內自然逢大吉','祈保分明得平安'],j:{'功名':'顯','月令':'吉','婚姻':'成','財利':'有','治病':'安','尋人':'至','官事':'勝','家運':'隆'}},
            {id:37,t:'庚子',l:'中吉',s:'周瑜曹操爭江北',p:['運逢得意身顯變','君爾身中皆有益','一向前途無難事','決意之中保清吉'],j:{'功名':'有','月令':'圓','婚姻':'成','財利':'有','治病':'癒','尋人':'至','官事':'吉','家運':'慶'}},
            {id:38,t:'庚寅',l:'中平',s:'趙子龍救阿斗',p:['名顯有意在中央','不須祈禱心自安','看看早晚日過後','即時得意在中間'],j:{'功名':'有','月令':'平','婚姻':'成','財利':'平','治病':'安','尋人':'至','官事':'吉','家運':'安'}},
            {id:39,t:'庚辰',l:'中吉',s:'唐明皇遊月宮',p:['意中若問神仙路','勸爾且退望高樓','寬心且守寬心坐','必然遇得貴人扶'],j:{'功名':'守','月令':'平','婚姻':'平','財利':'無','治病':'求神','尋人':'難','官事':'和','家運':'守'}},
            {id:40,t:'庚午',l:'下下',s:'蔡伯喈娘子遇虎',p:['平生富貴成祿位','君家門戶定光輝','此中必定無損失','夫妻百歲喜相隨'],j:{'功名':'無','月令':'平','婚姻':'平','財利':'平','治病':'拖','尋人':'難','官事':'吉','家運':'平'}},
            {id:41,t:'庚申',l:'中吉',s:'江東得道',p:['今行到手實難推','歌歌暢飲自徘徊','雞犬相聞消息近','婚姻夙世結成雙'],j:{'功名':'顯','月令':'吉','婚姻':'成','財利':'有','治病':'癒','尋人':'至','官事':'勝','家運':'隆'}},
            {id:42,t:'庚戌',l:'中平',s:'孟嘗君雞鳴度關',p:['一重江水一重山','誰知此去路又難','任他改求終不過','是非到底未得安'],j:{'功名':'有','月令':'平','婚姻':'好','財利':'利','治病':'安','尋人':'至','官事':'吉','家運':'安'}},
            {id:43,t:'辛丑',l:'上吉',s:'宋仁宗認母',p:['一年作事急如飛','君爾寬心莫遲疑','貴人還在千里外','音信月中漸漸知'],j:{'功名':'晚','月令':'平','婚姻':'成','財利':'晚','治病':'慢','尋人':'至','官事':'和','家運':'平'}},
            {id:44,t:'辛卯',l:'中吉',s:'蘇武牧羊',p:['客到前途多得利','君爾何故兩相疑','雖是中間逢進退','月出光輝得運時'],j:{'功名':'有','月令':'吉','婚姻':'合','財利':'有','治病':'安','尋人':'見','官事':'吉','家運':'安'}},
            {id:45,t:'辛巳',l:'下下',s:'三叔嫂記',p:['花開今已結成果','富貴榮華終到老','君子小人相會合','萬事清吉莫煩惱'],j:{'功名':'無','月令':'凶','婚姻':'凶','財利':'失','治病':'險','尋人':'杳','官事':'凶','家運':'衰'}},
            {id:46,t:'辛未',l:'中吉',s:'劉備求賢',p:['功名得位與君顯','前途富貴喜安然','若遇一輪明月照','十五團圓光滿天'],j:{'功名':'無','月令':'暗','婚姻':'難','財利':'無','治病':'拖','尋人':'難','官事':'和','家運':'守'}},
            {id:47,t:'辛酉',l:'上上',s:'莊子破棺',p:['君爾何須問聖跡','自己心中皆有益','於今且看月中旬','凶事脫出化成吉'],j:{'功名':'不遂','月令':'變','婚姻':'不合','財利':'無','治病':'險','尋人':'杳','官事':'凶','家運':'變'}},
            {id:48,t:'辛亥',l:'中平',s:'曹操遇關公',p:['陽世作事未和同','雲遮月色正朦朧','心中意欲前途去','只恐命內運未通'],j:{'功名':'無','月令':'暗','婚姻':'難','財利':'無','治病':'拖','尋人':'難','官事':'和','家運':'守'}},
            {id:49,t:'壬子',l:'中吉',s:'蘇琴碎琴',p:['言語雖多不可從','風雲靜處未行龍','暗中終得明消息','君爾何須問重重'],j:{'功名':'有','月令':'吉','婚姻':'好','財利':'有','治病':'安','尋人':'見','官事':'吉','家運':'慶'}},
            {id:50,t:'壬寅',l:'中平',s:'薛平貴別妻',p:['佛前發誓無異心','且看前途得好音','此物原來本是鐵','也能變化得成金'],j:{'功名':'有','月令':'吉','婚姻':'合','財利':'有','治病':'癒','尋人':'見','官事':'吉','家運':'平'}},
            {id:51,t:'壬辰',l:'中吉',s:'周瑜請孔明',p:['東西南北不堪行','前途此事正可當','勸君把定莫煩惱','家門自有保安康'],j:{'功名':'難','月令':'凶','婚姻':'平','財利':'無','治病':'求神','尋人':'難','官事':'和','家運':'守'}},
            {id:52,t:'壬午',l:'下下',s:'關公斬蔡陽',p:['功名事業本由天','不須掛念意懸懸','若問中間遲與速','風雲際會在眼前'],j:{'功名':'有','月令':'平','婚姻':'合','財利':'有','治病':'安','尋人':'至','官事':'吉','家運':'安'}},
            {id:53,t:'壬申',l:'中平',s:'楊文廣被困',p:['看君來問心中事','積善之家慶有餘','運亨財子雙雙至','指日喜氣溢門閭'],j:{'功名':'晚','月令':'平','婚姻':'慢','財利':'無','治病':'拖','尋人':'難','官事':'和','家運':'守'}},
            {id:54,t:'壬戌',l:'上吉',s:'三元會',p:['孤燈寂寂夜沉沉','萬事清吉萬事成','若逢陰世所注解','必定遭殃禍入門'],j:{'功名':'顯','月令':'吉','婚姻':'好','財利':'有','治病':'安','尋人':'至','官事':'勝','家運':'隆'}},
            {id:55,t:'癸丑',l:'中吉',s:'董永賣身',p:['須知進退總虛言','看看發暗未必全','珠玉深藏還未變','心中但得枉徒然'],j:{'功名':'有','月令':'平','婚姻':'成','財利':'有','治病':'癒','尋人':'見','官事':'吉','家運':'慶'}},
            {id:56,t:'癸卯',l:'中平',s:'溫金姑思親',p:['病中若得苦心勞','到底完全總未遭','去後不須回頭問','心中事務盡消磨'],j:{'功名':'難','月令':'凶','婚姻':'難','財利':'無','治病':'險','尋人':'杳','官事':'虧','家運':'不寧'}},
            {id:57,t:'癸巳',l:'中吉',s:'韓文公過秦嶺',p:['勸君把定心莫虛','天註衣祿自有餘','和合重重常吉慶','時來終遇得明珠'],j:{'功名':'晚','月令':'平','婚姻':'成','財利':'晚','治病':'慢','尋人':'至','官事':'和','家運':'平'}},
            {id:58,t:'癸未',l:'下下',s:'姜維吃水',p:['蛇身意欲變成龍','只恐命內運未通','久滯尚須大器晚','百鍊金剛始成鋼'],j:{'功名':'顯','月令':'吉','婚姻':'成','財利':'有','治病':'安','尋人':'至','官事':'勝','家運':'隆'}},
            {id:59,t:'癸酉',l:'上吉',s:'孔明祭七星',p:['有心作福莫遲疑','名利名山與利基','三箭開雲終有日','江山依舊是古碑'],j:{'功名':'有','月令':'平','婚姻':'成','財利':'平','治病':'安','尋人':'見','官事':'吉','家運':'安'}},
            {id:60,t:'癸亥',l:'上上',s:'楊六郎掛帥',p:['月出光輝本清吉','浮雲總是蔽陰色','戶內用心再作福','當官分理便有益'],j:{'功名':'顯','月令':'吉','婚姻':'成','財利':'有','治病':'癒','尋人':'至','官事':'勝','家運':'隆'}}
        ];

    // --- 黃大仙 100 籤資料庫 ---
    const WTS_LOTS = [
            {id:1,l:'上上',s:'姜公封相',p:['靈籤求得第一枝','龍虎風雲際會時','一旦凌霄揚自樂','任君來往赴瑤池'],j:{功名:'大吉',財利:'正財',婚姻:'美滿',家宅:'興旺',自身:'平安',求謀:'遂意',疾病:'即癒',出行:'順利'}},
            {id:2,l:'上吉',s:'王道真誤入桃源',p:['枯木逢春盡發新','花香葉茂蝶來頻','桃源競鬥千紅紫','一葉漁舟誤入津'],j:{功名:'有成',財利:'微利',婚姻:'和合',家宅:'安寧',自身:'吉利',求謀:'順遂',疾病:'可癒',出行:'平安'}},
            {id:3,l:'中平',s:'魯班開山',p:['牛山之木皆常美','獨惜斧工盡伐他','大器大材無足用','規矩不準怎為槎'],j:{功名:'難成',財利:'微薄',婚姻:'不合',家宅:'平常',自身:'修養',求謀:'難遂',疾病:'拖延',出行:'不利'}},
            {id:4,l:'中吉',s:'董永遇仙',p:['調雛紫燕在簷前','對語呢喃近午天','或往或來低復起','有時剪破綠楊煙'],j:{功名:'可望',財利:'有益',婚姻:'合',家宅:'吉',自身:'安',求謀:'可成',疾病:'無礙',出行:'吉'}},
            {id:5,l:'中吉',s:'韓夫人惜花',p:['東園昨夜狂風急','萬紫千紅亦盡傾','幸有惜花人早起','培回根本復栽生'],j:{功名:'有阻',財利:'待時',婚姻:'阻礙',家宅:'修整',自身:'謹慎',求謀:'苦後甘',疾病:'反覆',出行:'遲滯'}},
            {id:6,l:'上吉',s:'王羲之歸故里',p:['一片孤帆萬里回','管絃嘔啞且停杯','如雲勝友談風月','暢敘幽情極樂哉'],j:{功名:'顯達',財利:'豐收',婚姻:'美滿',家宅:'喜慶',自身:'康泰',求謀:'遂意',疾病:'即癒',出行:'大吉'}},
            {id:7,l:'中吉',s:'仁貴歸家',p:['秋水蒹葭白露盈','盈庭月色浸階清','清風吹動馬鈴響','響接晨鐘不斷聲'],j:{功名:'將成',財利:'平平',婚姻:'合',家宅:'漸佳',自身:'安',求謀:'有成',疾病:'漸癒',出行:'快至'}},
            {id:8,l:'下下',s:'崔子弒父',p:['鳴鳩爭奪鵲巢居','賓主參差意不舒','滿嶺喬松蘿蔦附','且猜詩語是何如'],j:{功名:'無望',財利:'失財',婚姻:'離異',家宅:'不寧',自身:'險阻',求謀:'不成',疾病:'凶',出行:'不宜'}},
            {id:9,l:'上吉',s:'陶淵明賞菊',p:['瑤琴一曲奏新腔','明月清風枕簟涼','咸集嘉賓同賞菊','或歌或舞或飛觴'],j:{功名:'高遷',財利:'大有',婚姻:'偕老',家宅:'昌盛',自身:'快樂',求謀:'必得',疾病:'即安',出行:'順風'}},
            {id:10,l:'中平',s:'蘇秦不第',p:['一輪月鏡掛空中','偶被浮雲障羽隆','玉魄本光無所損','少叫雲散便當空'],j:{功名:'待時',財利:'未有',婚姻:'遲成',家宅:'平平',自身:'忍耐',求謀:'暫阻',疾病:'可醫',出行:'遲'}},
            {id:11,l:'上吉',s:'漢文帝賞柳',p:['楊柳垂堤鎖綠煙','日長三起又三眠','往來紫燕紛飛舞','裊娜迎風倩我看'],j:{功名:'顯耀',財利:'順遂',婚姻:'和合',家宅:'吉慶',自身:'安康',求謀:'如意',疾病:'無礙',出行:'通達'}},
            {id:12,l:'下下',s:'太白撈月',p:['蜃樓海市幻無邊','萬丈擎空接上天','或被狂風忽吹散','有時仍聚結青煙'],j:{功名:'虛幻',財利:'空求',婚姻:'不成',家宅:'虛驚',自身:'浮沉',求謀:'無望',疾病:'險',出行:'阻隔'}},
            {id:13,l:'中平',s:'孟浩然尋梅',p:['嶺南初放一枝梅','片片晶瑩入酒杯','卻遇騎驢人早至','兒童背負占春魁'],j:{功名:'晚成',財利:'小利',婚姻:'平常',家宅:'安',自身:'勞碌',求謀:'勤得',疾病:'慢癒',出行:'吉'}},
            {id:14,l:'中吉',s:'蘇東坡醉酒',p:['為愛幽閒多種竹','買春賞雨在茅屋','醉時臥倒杏花邊','怕聽鶯兒驚夢熟'],j:{功名:'無求',財利:'隨緣',婚姻:'隨意',家宅:'清吉',自身:'逍遙',求謀:'順其自然',疾病:'無礙',出行:'可'}},
            {id:15,l:'上吉',s:'明皇遊月殿',p:['仙槎一葉報佳音','意氣風發上九天','要看嫦娥修月殿','廣寒宮內好團圓'],j:{功名:'大貴',財利:'大富',婚姻:'極佳',家宅:'光輝',自身:'發達',求謀:'必成',疾病:'即癒',出行:'大吉'}},
            {id:16,l:'中吉',s:'皇叔遇水鏡',p:['天邊鴉背夕陽回','隴外兒童跨犢來','羌笛頻吹聲切耳','短長腔調樂何哉'],j:{功名:'將至',財利:'漸有',婚姻:'合',家宅:'安',自身:'樂',求謀:'遇貴人',疾病:'癒',出行:'歸家'}},
            {id:17,l:'中吉',s:'月下追賢',p:['秋水蒹葭白露盈','盈庭月色浸階清','清風吹動馬鈴響','響接晨鐘不斷聲'],j:{功名:'有望',財利:'勤求',婚姻:'好',家宅:'吉',自身:'忙碌',求謀:'可成',疾病:'漸安',出行:'利'}},
            {id:18,l:'下下',s:'杜鵑泣血',p:['杜鵑啼血淚悲聲','聲怨霜寒夢戶驚','驚動異鄉為異客','客心更觸故園情'],j:{功名:'無',財利:'破財',婚姻:'凶',家宅:'不寧',自身:'愁苦',求謀:'艱難',疾病:'重',出行:'不宜'}},
            {id:19,l:'中吉',s:'伏羲畫八卦',p:['乾卦三連號順天','坤六斷處信地緣','八卦循環無休歇','造化無為本自然'],j:{功名:'順遂',財利:'有',婚姻:'和',家宅:'安',自身:'吉',求謀:'成',疾病:'癒',出行:'平'}},
            {id:20,l:'中平',s:'雪梅招親',p:['天上仙花難問種','人間塵事幾多更','前程已註公私簿','罰賞分明濁與清'],j:{功名:'平常',財利:'平穩',婚姻:'緣份',家宅:'一般',自身:'守分',求謀:'難',疾病:'保養',出行:'中'}},
            {id:21,l:'中吉',s:'武則天賞花',p:['天外紅霞如抹錦','門檻月影似鋪銀','一樽美酒邀明月','萬朵鮮花對美人'],j:{功名:'顯',財利:'旺',婚姻:'美',家宅:'吉',自身:'榮',求謀:'遂',疾病:'安',出行:'利'}},
            {id:22,l:'下下',s:'陳妙嫦思春',p:['秋水依人各一方','天南地北恨偏長','相思試問憑誰寄','不盡悽涼狂斷腸'],j:{功名:'無',財利:'無',婚姻:'離',家宅:'悶',自身:'苦',求謀:'不成',疾病:'憂',出行:'阻'}},
            {id:23,l:'中平',s:'盧生夢',p:['邯鄲一夢幻無邊','數載身榮是熟眠','換郤錦衣歸故里','睡醒還記在心田'],j:{功名:'虛',財利:'小',婚姻:'平',家宅:'常',自身:'醒悟',求謀:'虛',疾病:'醫',出行:'歸'}},
            {id:24,l:'下下',s:'白居易歸隱',p:['詩名赫奕震長安','布穀催春怨雨殘','早起歸休尋舊窟','南山猿鶴怨無端'],j:{功名:'退',財利:'散',婚姻:'難',家宅:'變',自身:'隱',求謀:'阻',疾病:'延',出行:'阻'}},
            {id:25,l:'上吉',s:'朱洪武登基',p:['群山擾擾朝中嶽','有似為臣列鵠班','拱立兩行齊整肅','自今宇內定尊閑'],j:{功名:'高',財利:'厚',婚姻:'成',家宅:'隆',自身:'吉',求謀:'遂',疾病:'除',出行:'暢'}},
            {id:26,l:'中平',s:'徐庶歸家',p:['花影遲遲侵砌上','遙知月鏡掛長空','忽聞鶴唳聲淒切','早買歸舟返里中'],j:{功名:'遲',財利:'平',婚姻:'待',家宅:'想家',自身:'安',求謀:'緩',疾病:'防',出行:'歸'}},
            {id:27,l:'中平',s:'越王復國',p:['天晴玄鳥雙雙飛','吳越參差時去歸','回首舊棲新主出','幾多艱苦願無違'],j:{功名:'復',財利:'勞',婚姻:'合',家宅:'興',自身:'苦盡',求謀:'成',疾病:'癒',出行:'利'}},
            {id:28,l:'中平',s:'白居易聽琵琶',p:['船泊潯陽月夜明','琵琶一曲動人情','相逢似是天涯客','說盡心中無限聲'],j:{功名:'無',財利:'薄',婚姻:'友',家宅:'平',自身:'感',求謀:'知音',疾病:'調',出行:'順'}},
            {id:29,l:'中吉',s:'張翰思鱸',p:['鱸魚膾美酒香醇','或是中秋月色新','一棹歸舟穿白浪','採蓴還憶舊時人'],j:{功名:'退',財利:'足',婚姻:'念舊',家宅:'安',自身:'樂',求謀:'遂',疾病:'安',出行:'歸'}},
            {id:30,l:'下下',s:'貴妃自縊',p:['傾國傾城恨有餘','幾多紅粉抱琵琶','看他強馬終無用','一旦無常萬事休'],j:{功名:'失',財利:'損',婚姻:'破',家宅:'凶',自身:'危',求謀:'敗',疾病:'重',出行:'險'}},
            {id:31,l:'下下',s:'蔡中興遇險',p:['狂風驟雨打船篷','溪畔桃花盡落紅','驚醒漁翁春夢破','幾多心事總成空'],j:{功名:'廢',財利:'耗',婚姻:'離',家宅:'驚',自身:'險',求謀:'空',疾病:'災',出行:'阻'}},
            {id:32,l:'中平',s:'蘇武牧羊',p:['十九年前海上辛','節旄彫敗逐沙塵','餐毛嚼雪誰憐我','留得丹心照漢濱'],j:{功名:'遲',財利:'難',婚姻:'滯',家宅:'貧',自身:'苦',求謀:'艱',疾病:'久',出行:'遠'}},
            {id:33,l:'中平',s:'孔明借東風',p:['曹操雖有百萬兵','更無一計破孔明','借得東風攻敵去','全軍瓦解沒逃生'],j:{功名:'險中求',財利:'智取',婚姻:'合',家宅:'安',自身:'智',求謀:'成',疾病:'癒',出行:'利'}},
            {id:34,l:'中吉',s:'虞舜耕田',p:['大舜雖耕在歷山','心常孝順兩親顏','田中之象同家象','一般不但只一般'],j:{功名:'顯',財利:'有',婚姻:'善',家宅:'睦',自身:'順',求謀:'遂',疾病:'安',出行:'吉'}},
            {id:35,l:'中吉',s:'唐僧取經',p:['天將降任與其人','必先勞碌苦其身','若不經過勤與苦','焉能取得經卷真'],j:{功名:'苦後甜',財利:'勤得',婚姻:'堅',家宅:'安',自身:'煉',求謀:'成',疾病:'療',出行:'遠'}},
            {id:36,l:'中吉',s:'薛平貴歸家',p:['此事真如到岸船','何憂風浪不週全','一生受盡艱辛苦','這番名利兩相全'],j:{功名:'成',財利:'全',婚姻:'合',家宅:'吉',自身:'安',求謀:'遂',疾病:'癒',出行:'至'}},
            {id:37,l:'上吉',s:'東坡遊赤壁',p:['月夜舟中赤壁遊','齊名三國姓名留','千古風流人物在','昔年一戰在荊州'],j:{功名:'有',財利:'豐',婚姻:'合',家宅:'旺',自身:'吉',求謀:'遂',疾病:'除',出行:'快'}},
            {id:38,l:'中吉',s:'陶淵明辭官',p:['歸去來兮歲月斜','秋風老圃看黃花','雖然未得高官做','且是無憂快樂家'],j:{功名:'捨',財利:'足',婚姻:'和',家宅:'樂',自身:'安',求謀:'平',疾病:'無',出行:'歸'}},
            {id:39,l:'中吉',s:'夷齊讓國',p:['夷齊不忍食周粟','兄弟心同去首陽','抱節清名留萬古','至今千載有餘香'],j:{功名:'虛',財利:'淡',婚姻:'和',家宅:'安',自身:'清',求謀:'難',疾病:'安',出行:'阻'}},
            {id:40,l:'下下',s:'伯牙碎琴',p:['古琴雖好少知音','弦斷誰憐一片心','若得知音人聽採','一律彈來值萬金'],j:{功名:'無',財利:'無',婚姻:'孤',家宅:'冷',自身:'悲',求謀:'難',疾病:'拖',出行:'阻'}},
            {id:41,l:'中吉',s:'張騫獲寶石',p:['浮槎月夜到天河','曾見天星似織梭','石得支機人罕識','那知此寶出絲羅'],j:{功名:'顯',財利:'得',婚姻:'成',家宅:'吉',自身:'安',求謀:'遂',疾病:'醫',出行:'利'}},
            {id:42,l:'中吉',s:'王允獻貂嬋',p:['月明散步到花欄','無策焉能剿滅奸','幸有貂蟬思定國','英雄難過美人關'],j:{功名:'計謀',財利:'險得',婚姻:'合',家宅:'安',自身:'吉',求謀:'成',疾病:'癒',出行:'利'}},
            {id:43,l:'下下',s:'韓文公被貶',p:['只因直諫觸龍顏','晝夜驅馳去度關','馬死風號天下雪','全憑湘子度藍關'],j:{功名:'失',財利:'耗',婚姻:'滯',家宅:'驚',自身:'危',求謀:'敗',疾病:'險',出行:'阻'}},
            {id:44,l:'中吉',s:'唐天寶評花',p:['滿園春色鬥新妝','意似爭妍奪國香','到底是誰居第一','梅花老圃薦孤芳'],j:{功名:'望',財利:'有',婚姻:'合',家宅:'吉',自身:'安',求謀:'成',疾病:'癒',出行:'利'}},
            {id:45,l:'中平',s:'王質遇仙',p:['採樵信步入深山','見兩仙翁在此間','局未終時柯已爛','歸家且喜日方閒'],j:{功名:'無',財利:'平',婚姻:'遲',家宅:'變',自身:'閒',求謀:'緩',疾病:'延',出行:'遠'}},
            {id:46,l:'下下',s:'左慈戲曹操',p:['黃金滿屋少人知','一旦逢春轉更遲','欲問前程何處去','一聲歸笛是何時'],j:{功名:'虛',財利:'失',婚姻:'難',家宅:'憂',自身:'險',求謀:'空',疾病:'重',出行:'阻'}},
            {id:47,l:'中平',s:'魯肅索荊州',p:['看花稱意在芳菲','花落風飄總若希','若得寸進宜退步','如周若始又重圍'],j:{功名:'滯',財利:'無',婚姻:'阻',家宅:'平',自身:'守',求謀:'難',疾病:'延',出行:'阻'}},
            {id:48,l:'中平',s:'卓文君賣酒',p:['繡球結下五花棚','故事傳聞在錦城','從此如龍添一角','半推半就作成親'],j:{功名:'可',財利:'有',婚姻:'合',家宅:'吉',自身:'安',求謀:'成',疾病:'癒',出行:'利'}},
            {id:49,l:'中吉',s:'司馬相如題橋',p:['十年窗下苦功修','今日飛騰上鳳樓','九萬里天風送我','青雲得路任遨遊'],j:{功名:'顯',財利:'厚',婚姻:'美',家宅:'旺',自身:'榮',求謀:'遂',疾病:'癒',出行:'吉'}},
            {id:50,l:'中吉',s:'伍員出關',p:['枯木逢春再發花','雨過天青獨自誇','此日過關樊籠破','任君來往走天涯'],j:{功名:'成',財利:'有',婚姻:'合',家宅:'吉',自身:'脫難',求謀:'遂',疾病:'癒',出行:'通'}},
            {id:51,l:'中平',s:'成王剪桐封第',p:['剪桐小戲也封王','可見天心重主張','富貴榮華天註定','五行生剋莫荒唐'],j:{功名:'有',財利:'平',婚姻:'合',家宅:'安',自身:'吉',求謀:'順',疾病:'安',出行:'利'}},
            {id:52,l:'中平',s:'盤古開天闢地',p:['盤古初開天地清','陰陽造化日光明','參差世事無相定','或是人生夢裡驚'],j:{功名:'未定',財利:'平',婚姻:'待',家宅:'安',自身:'慎',求謀:'疑',疾病:'防',出行:'阻'}},
            {id:53,l:'中吉',s:'馮曖客孟嘗',p:['珠履三千客孟嘗','誰人識得有鷹揚','其中彈鋏歸來者','便是英雄志氣長'],j:{功名:'望',財利:'有',婚姻:'合',家宅:'吉',自身:'榮',求謀:'遂',疾病:'癒',出行:'利'}},
            {id:54,l:'中平',s:'莊周夢蝶',p:['莊子逍遙達道經','夢迷魂蝶亦相應','任他富貴榮華事','幻化無常且暫停'],j:{功名:'虛',財利:'微',婚姻:'平',家宅:'安',自身:'悟',求謀:'空',疾病:'安',出行:'吉'}},
            {id:55,l:'中平',s:'吳隱之投沉香',p:['浦號沉香遺舊恨','渡江猶憶古人心','可憐當日辭官去','雖有馨留不易尋'],j:{功名:'退',財利:'散',婚姻:'平',家宅:'安',自身:'清',求謀:'難',疾病:'醫',出行:'歸'}},
            {id:56,l:'中吉',s:'呂祖桃木劍',p:['安知此劍不成龍','見水都應化作龍','第一鋒頭方有準','誅妖殺怪沐春風'],j:{功名:'成',財利:'有',婚姻:'吉',家宅:'安',自身:'吉',求謀:'遂',疾病:'除',出行:'利'}},
            {id:57,l:'中吉',s:'獨佔花魁',p:['小樓春雨聲初歇','徘徊街頭屐不停','忽聽賣花人入巷','一枝獨佔好春情'],j:{功名:'遂',財利:'得',婚姻:'合',家宅:'吉',自身:'安',求謀:'成',疾病:'癒',出行:'利'}},
            {id:58,l:'下下',s:'蹇叔哭師',p:['秦師大敗在殽山','三帥皆擒盡放還','蹇叔諫言因不聽','倒戈棄甲不堪看'],j:{功名:'敗',財利:'失',婚姻:'破',家宅:'凶',自身:'危',求謀:'敗',疾病:'重',出行:'險'}},
            {id:59,l:'下下',s:'東施效顰',p:['圖容西子貌嬋娟','誰知東施效顰難','不攝照磨偏自醜','更教人笑被人嫌'],j:{功名:'無',財利:'無',婚姻:'難',家宅:'衰',自身:'醜',求謀:'敗',疾病:'憂',出行:'阻'}},
            {id:60,l:'中平',s:'李白醉和番書',p:['和番書詔在忙中','醉倒金鑾酒尚濃','只有天才李太白','能將草詔嚇番戎'],j:{功名:'顯',財利:'平',婚姻:'合',家宅:'安',自身:'吉',求謀:'成',疾病:'癒',出行:'利'}},
            {id:61,l:'下下',s:'十二金牌召嶽飛',p:['十二金牌速召回','奸雄陰險欲成災','將軍一旦遭羅網','從此民間少將才'],j:{功名:'凶',財利:'失',婚姻:'破',家宅:'危',自身:'險',求謀:'敗',疾病:'重',出行:'忌'}},
            {id:62,l:'中平',s:'孔子守道',p:['孔聖刪書在韋編','龍門太史筆如椽','春秋筆法無私曲','筆削聲名四海傳'],j:{功名:'久',財利:'平',婚姻:'吉',家宅:'安',自身:'修',求謀:'成',疾病:'安',出行:'吉'}},
            {id:63,l:'中吉',s:'顏回樂道安貧',p:['陋巷簞瓢不足憂','傍人見了替他愁','不知樂道無窮樂','富貴榮華不到頭'],j:{功名:'淡',財利:'薄',婚姻:'和',家宅:'平',自身:'安',求謀:'隨',疾病:'無',出行:'可'}},
            {id:64,l:'中吉',s:'孟之反殿師',p:['奔殿當年膽氣雄','此間稱美孟之功','一心忠義無人識','不怕軍驚敗若風'],j:{功名:'成',財利:'有',婚姻:'合',家宅:'吉',自身:'勇',求謀:'遂',疾病:'癒',出行:'利'}},
            {id:65,l:'下下',s:'後主失國',p:['隋滅陳時已可知','陳兵未動國先危','井底胭脂波染紅','可憐後主在宮闈'],j:{功名:'敗',財利:'失',婚姻:'破',家宅:'傾',自身:'危',求謀:'絕',疾病:'凶',出行:'阻'}},
            {id:66,l:'上吉',s:'羲之會群賢',p:['蘭亭雅會眾群賢','曲水流觴在目前','快樂如斯真少有','有詩有畫樂安然'],j:{功名:'顯',財利:'豐',婚姻:'美',家宅:'昌',自身:'樂',求謀:'遂',疾病:'安',出行:'吉'}},
            {id:67,l:'中平',s:'李元霸稱雄',p:['人誇力氣舉千斤','四海為家又稱尊','若是匹夫無智慮','更教人笑沒精神'],j:{功名:'虛',財利:'有',婚姻:'平',家宅:'安',自身:'戒',求謀:'難',疾病:'防',出行:'阻'}},
            {id:68,l:'中吉',s:'姜太公得志',p:['久抱經綸未得施','渭川垂釣老鬚眉','皇天不負文王意','載得賢臣歸去來'],j:{功名:'成',財利:'有',婚姻:'合',家宅:'吉',自身:'順',求謀:'遂',疾病:'癒',出行:'利'}},
            {id:69,l:'中吉',s:'韓文公祭鱷魚',p:['忠義存心上達天','鱷魚為害少安然','文公一表祭鱷魚','去卻奇災福壽全'],j:{功名:'顯',財利:'有',婚姻:'合',家宅:'安',自身:'吉',求謀:'成',疾病:'除',出行:'利'}},
            {id:70,l:'中平',s:'塞翁失馬',p:['可比當年一塞翁','雖然失馬半途中','不知禍福真難測','幸得兒孫後來功'],j:{功名:'晚',財利:'復',婚姻:'合',家宅:'平',自身:'安',求謀:'順',疾病:'疑',出行:'吉'}},
            {id:71,l:'中平',s:'莊周活鮒魚',p:['涸轍之中鮒困之','呼號望救甚堪悲','若能引得西江水','他日成龍也未知'],j:{功名:'難',財利:'困',婚姻:'滯',家宅:'艱',自身:'苦',求謀:'待',疾病:'延',出行:'阻'}},
            {id:72,l:'中平',s:'高文定守困',p:['弄蜂須要求他蜜','只怕遭他尾上針','雖是眼前有異路','暗裏深藏荊棘林'],j:{功名:'無',財利:'險',婚姻:'防',家宅:'戒',自身:'慎',求謀:'阻',疾病:'防',出行:'止'}},
            {id:73,l:'上吉',s:'孫策怒殺于吉',p:['射鹿當年在此間','江東父老盡開顏','雖然項羽無雙勇','爭得中原百二山'],j:{功名:'顯',財利:'有',婚姻:'合',家宅:'吉',自身:'安',求謀:'成',疾病:'癒',出行:'利'}},
            {id:74,l:'下下',s:'朱買臣分妻',p:['回憶當年運蹇時','夫妻反目兩分離','名題雁塔歸來後','覆水馬頭時悔遲'],j:{功名:'遲',財利:'無',婚姻:'破',家宅:'變',自身:'悔',求謀:'難',疾病:'憂',出行:'阻'}},
            {id:75,l:'下下',s:'倫文敘戲妻',p:['婚姻豈可當兒戲','二姓合婚非易事','若不嚴肅終後悔','百年偕老費心機'],j:{功名:'無',財利:'微',婚姻:'險',家宅:'平',自身:'慎',求謀:'難',疾病:'拖',出行:'阻'}},
            {id:76,l:'中平',s:'孔明撫琴退仲達',p:['人能樂道自安居','何必奔波走四方','處處無非真樂地','何時花發不傳香'],j:{功名:'修',財利:'平',婚姻:'安',家宅:'吉',自身:'樂',求謀:'順',疾病:'安',出行:'可'}},
            {id:77,l:'中平',s:'公冶長入獄',p:['鳥語能通公冶長','南山虎豹把羊傷','雖然獲罪非為盜','夢裡囹圄無事殃'],j:{功名:'阻',財利:'失',婚姻:'驚',家宅:'不安',自身:'險',求謀:'難',疾病:'防',出行:'凶'}},
            {id:78,l:'上吉',s:'曾點瑟希',p:['瑟希鏗爾奏新聲','風乎舞雩詠歸亭','夫子當年曾點許','春風滿座樂昇平'],j:{功名:'遂',財利:'豐',婚姻:'美',家宅:'旺',自身:'樂',求謀:'成',疾病:'癒',出行:'吉'}},
            {id:79,l:'中吉',s:'張良拾履',p:['富貴榮華天註定','安邦定國盡忠貞','一旦功成身退後','長生不老過一生'],j:{功名:'成',財利:'有',婚姻:'合',家宅:'吉',自身:'安',求謀:'遂',疾病:'癒',出行:'利'}},
            {id:80,l:'中吉',s:'樂廣釋疑',p:['飛觴解化酒杯蛇','疑似消除福有加','從此清閒無一事','寬心飲酒醉流霞'],j:{功名:'顯',財利:'足',婚姻:'合',家宅:'安',自身:'樂',求謀:'成',疾病:'除',出行:'利'}},
            {id:81,l:'中平',s:'子路問事',p:['子路問事不問神','聖人答語最精真','若要問神先問己','修身積德福來臨'],j:{功名:'修',財利:'勤',婚姻:'吉',家宅:'安',自身:'省',求謀:'順',疾病:'醫',出行:'吉'}},
            {id:82,l:'中平',s:'孔子擊磬',p:['聖人擊磬在衛邦','荷蕢且過門邊廂','雖然心事無人識','也有知音細論量'],j:{功名:'遲',財利:'平',婚姻:'待',家宅:'安',自身:'守',求謀:'緩',疾病:'安',出行:'可'}},
            {id:83,l:'中平',s:'赤松子招隱',p:['星辰隱沒月無光','隱躍朦朧入睡鄉','夢裡不知身是客','醒來方覺在他鄉'],j:{功名:'無',財利:'平',婚姻:'平',家宅:'安',自身:'迷',求謀:'難',疾病:'防',出行:'阻'}},
            {id:84,l:'中平',s:'韓信棄楚歸漢',p:['滿腹奇才志未伸','棄楚歸漢遇知音','雖然一旦風雲會','也算英雄老逐心'],j:{功名:'遲',財利:'有',婚姻:'合',家宅:'吉',自身:'安',求謀:'成',疾病:'癒',出行:'利'}},
            {id:85,l:'中吉',s:'劉邦斬蛇',p:['太乙燃藜照讀書','十年窗下苦功夫','揚眉吐氣風雲際','金榜題名屬丈夫'],j:{功名:'顯',財利:'旺',婚姻:'美',家宅:'興',自身:'榮',求謀:'遂',疾病:'癒',出行:'吉'}},
            {id:86,l:'中吉',s:'侃母截髮',p:['截髮延賓傳美談','陶公運甓亦如然','其中極有真奇節','史策流芳萬古傳'],j:{功名:'成',財利:'有',婚姻:'賢',家宅:'吉',自身:'安',求謀:'遂',疾病:'癒',出行:'利'}},
            {id:87,l:'中平',s:'荀巨伯探病',p:['跋涉途程往探親','誰知好友病呻吟','夢中說話無人信','空使慈親痛在心'],j:{功名:'無',財利:'損',婚姻:'愁',家宅:'憂',自身:'苦',求謀:'阻',疾病:'凶',出行:'險'}},
            {id:88,l:'中吉',s:'花木蘭代父從軍',p:['代父從軍膽氣雄','忠心報國顯英雄','雖然身是女兒輩','一旦功成萬古崇'],j:{功名:'顯',財利:'有',婚姻:'遲',家宅:'吉',自身:'勇',求謀:'遂',疾病:'安',出行:'利'}},
            {id:89,l:'中平',s:'吳季子掛劍',p:['他鄉遠歷久淹留','歸到家鄉事轉愁','惟有解劍掛墳樹','才知心事不知休'],j:{功名:'無',財利:'無',婚姻:'悲',家宅:'愁',自身:'嘆',求謀:'難',疾病:'憂',出行:'苦'}},
            {id:90,l:'中平',s:'紅拂女私奔',p:['細雨春風濕翠翹','一鞭馬上逞妖嬌','相逢俠客紅塵外','配得英豪也不饒'],j:{功名:'可',財利:'平',婚姻:'合',家宅:'安',自身:'吉',求謀:'成',疾病:'癒',出行:'利'}},
            {id:91,l:'中吉',s:'月裡念奴',p:['蟾宮月殿桂飄香','玉兔長生搗藥忙','吳剛伐樹無休日','幸有嫦娥助淡妝'],j:{功名:'成',財利:'有',婚姻:'合',家宅:'吉',自身:'安',求謀:'遂',疾病:'癒',出行:'利'}},
            {id:92,l:'中吉',s:'孔子聞韶',p:['三月聞韶不知味','可憐夫子聽聲音','當時一國皆瘋狂','此曲只應天上聞'],j:{功名:'有',財利:'足',婚姻:'合',家宅:'吉',自身:'樂',求謀:'遂',疾病:'安',出行:'利'}},
            {id:93,l:'中平',s:'孔子歎鳳',p:['鳳鳥不至河無圖','微子淒涼歎道窮','唯有後人知此意','詩書傳誦萬年功'],j:{功名:'遲',財利:'平',婚姻:'待',家宅:'平',自身:'修',求謀:'難',疾病:'防',出行:'阻'}},
            {id:94,l:'中平',s:'劉琦奔江夏',p:['一派長江水向東','扁舟順水逞英雄','雖然風浪多驚險','還有貴人相助功'],j:{功名:'險',財利:'有',婚姻:'合',家宅:'安',自身:'吉',求謀:'成',疾病:'癒',出行:'利'}},
            {id:95,l:'下下',s:'女媧煉石',p:['功高補天少人知','煉石當年費心機','只恐蒼天還有漏','不教神女淚沾衣'],j:{功名:'無',財利:'耗',婚姻:'悲',家宅:'憂',自身:'勞',求謀:'難',疾病:'重',出行:'苦'}},
            {id:96,l:'中平',s:'文姬歸漢',p:['羌笛頻吹韻更悲','異鄉為客淚沾衣','幸得一朝歸漢室','方知今日是歸期'],j:{功名:'遲',財利:'平',婚姻:'合',家宅:'吉',自身:'苦盡',求謀:'成',疾病:'癒',出行:'歸'}},
            {id:97,l:'中吉',s:'康熙微服',p:['憑欄晚眺倚南樓','滿目風光景色幽','一葉小舟頻往來','箇中人去不知愁'],j:{功名:'顯',財利:'有',婚姻:'合',家宅:'安',自身:'樂',求謀:'遂',疾病:'無',出行:'利'}},
            {id:98,l:'中平',s:'管鮑分金',p:['入山種玉復分金','貴賤交情見此心','若得管鮑同心意','磨礱砥礪總成珍'],j:{功名:'有',財利:'平',婚姻:'合',家宅:'吉',自身:'安',求謀:'成',疾病:'癒',出行:'利'}},
            {id:99,l:'中平',s:'韓文公遇雪',p:['雪擁藍關馬不前','風吹號令滿驚天','雖然身在此中苦','還有韓湘在面前'],j:{功名:'阻',財利:'難',婚姻:'滯',家宅:'憂',自身:'苦',求謀:'待',疾病:'防',出行:'阻'}},
            {id:100,l:'中吉',s:'唐明皇賞花',p:['百花競放賀陽春','萬物從今盡轉新','末數莫言窮運至','不知否極泰來臨'],j:{功名:'顯',財利:'旺',婚姻:'美',家宅:'隆',自身:'吉',求謀:'遂',疾病:'癒',出行:'利'}}
        ];

    function cn(...xs) {
      return xs.filter(Boolean).join(" ");
    }

    function MoonBlock({ type, rotateClass }) {
      const isYang = type === 1;
      const base = "w-20 h-20 md:w-24 md:h-24 rounded-2xl border border-yellow-300/30 shadow-xl";
      return (
        <div className={cn("transform-style-3d backface-hidden", rotateClass)}
             style={{ "--rotate-end-left": "180deg", "--rotate-end-right": "180deg" }}>
          <div className={cn(base, "bg-gradient-to-b", isYang ? "from-amber-100 to-amber-300" : "from-amber-200 to-amber-100")}>
            <div className="w-full h-full flex items-center justify-center">
              <span className={cn("text-xl md:text-2xl font-bold", isYang ? "text-stone-900" : "text-stone-700")}>
                {isYang ? "陽" : "陰"}
              </span>
            </div>
          </div>
        </div>
      );
    }

    function Pill({ children }) {
      return (
        <span className="inline-flex items-center px-3 py-1 rounded-full bg-stone-900/40 border border-yellow-600/30 text-yellow-100 text-xs">
          {children}
        </span>
      );
    }

    function SectionTitle({ icon, title, subtitle }) {
      return (
        <div className="text-center">
          <div className="text-3xl mb-2">{icon}</div>
          <h2 className="text-2xl md:text-3xl font-bold tracking-widest text-yellow-100 drop-shadow">{title}</h2>
          {subtitle && <p className="mt-2 text-sm text-yellow-200/70 leading-relaxed">{subtitle}</p>}
        </div>
      );
    }

    function App() {
      const [step, setStep] = useState(STEPS.SELECT_DEITY);
      const [deity, setDeity] = useState(null); // 'mazu' | 'wts'
      const [name, setName] = useState("");
      const [question, setQuestion] = useState("");
      const [message, setMessage] = useState("");
      const [beiResult, setBeiResult] = useState("");
      const [isTossing, setIsTossing] = useState(false);
      const [leftBeiType, setLeftBeiType] = useState(0);
      const [rightBeiType, setRightBeiType] = useState(1);
      const [tossCount, setTossCount] = useState(0);

      const [tempLot, setTempLot] = useState(null);
      const [guidanceText, setGuidanceText] = useState("");
      const [showDetails, setShowDetails] = useState(false);

      const [isShaking, setIsShaking] = useState(false);
      const canvasRef = useRef(null);

      const lots = useMemo(() => {
        if (deity === "mazu") return MAZU_LOTS;
        if (deity === "wts") return WTS_LOTS;
        return [];
      }, [deity]);

      const deityMeta = useMemo(() => {
        if (deity === "mazu") return {
          title: "天后宮",
          symbol: "媽",
          desc: "天上聖母 ‧ 溫暖指引（60籤）"
        };
        if (deity === "wts") return {
          title: "黃大仙祠",
          symbol: "仙",
          desc: "有求必應 ‧ 玄機妙算（100籤）"
        };
        return null;
      }, [deity]);

      function resetAll(goToSelect=false) {
        setIsTossing(false);
        setIsShaking(false);
        setBeiResult("");
        setMessage("");
        setTossCount(0);
        setTempLot(null);
        setGuidanceText("");
        setShowDetails(false);
        if (goToSelect) {
          setDeity(null);
          setName("");
          setQuestion("");
          setStep(STEPS.SELECT_DEITY);
        } else {
          setStep(STEPS.INPUT);
        }
      }

      function performToss(purpose) {
        if (isTossing) return;
        setIsTossing(true);
        setBeiResult("");
        setMessage("誠心擲出…");
        setTossCount(c => c + 1);

        const nextL = Math.random() < 0.5 ? 0 : 1;
        const nextR = Math.random() < 0.5 ? 0 : 1;
        setLeftBeiType(nextL);
        setRightBeiType(nextR);

        setTimeout(() => {
          const r = Math.random();
          let result;
          if (purpose === "permission") result = r < 0.68 ? "聖筊" : (r < 0.84 ? "笑筊" : "陰筊");
          else result = r < 0.55 ? "聖筊" : (r < 0.74 ? "笑筊" : "陰筊");

          setBeiResult(result);

          if (result === "聖筊") {
            setMessage(purpose === "permission" ? "得聖筊！神明允諾賜籤。" : "得聖筊！此籤已獲確認。");
            setTimeout(() => {
              setIsTossing(false);
              setStep(purpose === "permission" ? STEPS.SHAKING : STEPS.AI_ANALYZING);
            }, 500);
          } else {
            setMessage(result === "笑筊" ? "笑筊：請再整一整心意，再試一次。" : "陰筊：此刻不宜，建議稍作沉澱再問。");
            setTimeout(() => setIsTossing(false), 600);
          }
        }, 1700);
      }

      function pickLot() {
        const i = Math.floor(Math.random() * lots.length);
        const lot = lots[i];
        setTempLot(lot);
        setStep(STEPS.CONFIRM_LOT);
      }

      function generateGuidance(lot) {
        const base = deity === "mazu"
          ? "媽祖籤意多重視「心正、行穩、積善」"
          : "黃大仙籤意多重視「時機、取捨、修心」";

        const level = lot?.l || "平";
        const story = lot?.s ? `典故「${lot.s}」` : "典故";
        const q = (question || "").trim();
        const who = (name || "").trim() ? `${name}，` : "";

        const tips = [
          "把問題縮成一句最核心的決策點，再檢查你真正擔心的是「結果」還是「過程」。",
          "若近期情緒波動大，先把可控事項列出：時間、資源、要找誰協助。",
          "以「小步試驗」代替一次到位：先做最小可行的一步，觀察回饋再調整。"
        ];

        const caution = [
          "避免因焦慮而反覆問同一題；改用「設定期限」：例如一週後再檢視一次。",
          "重要決策仍請結合專業建議與現實條件評估（健康/法律/財務尤需謹慎）。"
        ];

        return (
`${who}${base}。

【籤級】${level}
【參考】${story}
${q ? `【所問】${q}
` : ""}
【建議】
- ${tips.join("\n- ")}

【提醒】
- ${caution.join("\n- ")}`
        );
      }

      function runAnalyzing() {
        setMessage("正在解籤…心靜則籤明。");
        setTimeout(() => {
          const g = generateGuidance(tempLot);
          setGuidanceText(g);
          setMessage("");
          setStep(STEPS.RESULT);
        }, 1200);
      }

      useEffect(() => {
        if (step === STEPS.AI_ANALYZING && tempLot) runAnalyzing();
      }, [step, tempLot]);

      function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
        const words = text.split(/\s+/);
        let line = "";
        for (let n = 0; n < words.length; n++) {
          const testLine = line + words[n] + " ";
          const testWidth = ctx.measureText(testLine).width;
          if (testWidth > maxWidth && n > 0) {
            ctx.fillText(line, x, y);
            line = words[n] + " ";
            y += lineHeight;
          } else {
            line = testLine;
          }
        }
        ctx.fillText(line, x, y);
      }

      function downloadImage() {
        if (!canvasRef.current || !tempLot || !guidanceText) return;

        const canvas = canvasRef.current;
        const ctx = canvas.getContext("2d");
        const W = 1080, H = 1350;
        canvas.width = W;
        canvas.height = H;

        ctx.fillStyle = "#FFFBF0";
        ctx.fillRect(0, 0, W, H);

        ctx.strokeStyle = deity === "mazu" ? "#7f1d1d" : "#92400e";
        ctx.lineWidth = 18;
        ctx.strokeRect(24, 24, W - 48, H - 48);

        ctx.fillStyle = "#111827";
        ctx.font = "bold 44px 'Noto Serif TC', serif";
        const title = deity === "mazu" ? "天后宮 線上靈籤" : "黃大仙祠 線上靈籤";
        ctx.fillText(title, 80, 120);

        ctx.fillStyle = deity === "mazu" ? "#7f1d1d" : "#92400e";
        ctx.font = "bold 36px 'Noto Serif TC', serif";
        const lotTitle = deity === "mazu" ? `${tempLot.t}籤（第 ${tempLot.id} 籤）` : `第 ${tempLot.id} 籤`;
        ctx.fillText(lotTitle, 80, 190);

        ctx.fillStyle = "#374151";
        ctx.font = "28px 'Noto Serif TC', serif";
        ctx.fillText(`【${tempLot.l}】 ${tempLot.s || ""}`, 80, 240);

        ctx.fillStyle = "#111827";
        ctx.font = "28px 'Noto Serif TC', serif";
        const poem = (tempLot.p || []).join("　");
        wrapText(ctx, poem, 80, 310, 920, 40);

        ctx.fillStyle = "#111827";
        ctx.font = "24px 'Noto Serif TC', serif";
        const g = guidanceText.replace(/
/g, " ");
        wrapText(ctx, g, 80, 580, 920, 34);

        ctx.fillStyle = "#6b7280";
        ctx.font = "22px 'Noto Serif TC', serif";
        ctx.fillText("本圖為線上體驗結果，請以平常心參考。", 80, H - 110);
        ctx.fillText("生成時間：2025-12-18 16:37", 80, H - 70);

        const link = document.createElement("a");
        link.download = (deity === "mazu" ? "mazu-lot.png" : "wts-lot.png");
        link.href = canvas.toDataURL("image/png");
        link.click();
      }

      function DetailGrid() {
        const entries = tempLot?.j ? Object.entries(tempLot.j) : [];
        if (!entries.length) return null;
        return (
          <div className="grid grid-cols-2 md:grid-cols-3 gap-2 mt-3">
            {entries.map(([k, v]) => (
              <div key={k} className="bg-white/70 border border-stone-200 rounded-lg px-3 py-2 text-stone-900">
                <div className="text-xs text-stone-500">{k}</div>
                <div className="text-sm font-bold">{String(v)}</div>
              </div>
            ))}
          </div>
        );
      }

      return (
        <div className="min-h-screen relative">
          <div className="absolute inset-0 opacity-20 pointer-events-none"
               style={{ backgroundImage: "radial-gradient(circle at 20% 10%, rgba(245,158,11,.4), transparent 40%), radial-gradient(circle at 80% 70%, rgba(220,38,38,.35), transparent 45%)" }} />

          <main className="min-h-screen flex flex-col items-center justify-center px-4 py-10">
            <div className="w-full max-w-3xl">
              <div className="flex items-center justify-between mb-6">
                <div className="flex items-center gap-2">
                  <span className="text-2xl">🧧</span>
                  <div className="leading-tight">
                    <div className="text-sm text-yellow-200/70">線上靈籤（完整典藏版）</div>
                    <div className="text-lg font-bold text-yellow-100 tracking-wider">天后宮 & 黃大仙</div>
                  </div>
                </div>
                <div className="flex items-center gap-2">
                  {deity && <Pill>已選：{deityMeta?.title}</Pill>}
                  <button
                    className="px-3 py-2 rounded-lg bg-stone-900/40 border border-yellow-600/30 text-yellow-100 text-xs hover:bg-stone-900/60"
                    onClick={() => resetAll(true)}
                  >
                    重新選擇
                  </button>
                </div>
              </div>

              <div className="relative bg-stone-900/60 border border-yellow-600/30 rounded-2xl shadow-2xl overflow-hidden">
                <div className="absolute inset-0 opacity-20 pointer-events-none"
                     style={{ backgroundImage: "linear-gradient(135deg, rgba(245,158,11,.45), transparent 40%), linear-gradient(45deg, rgba(220,38,38,.35), transparent 35%)" }} />
                <div className="relative p-6 md:p-8">

                  {step === STEPS.SELECT_DEITY && (
                    <div className="space-y-8 animate-fade-in">
                      <SectionTitle
                        icon="🏮"
                        title="請選擇參拜殿堂"
                        subtitle="本服務為線上體驗形式，模擬擲筊與抽籤流程。請以平常心參考，心誠最重要。"
                      />
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button
                          className="group text-left p-5 rounded-2xl bg-red-950/50 border border-red-500/30 hover:bg-red-950/65 transition shadow-[0_0_30px_rgba(220,38,38,0.22)]"
                          onClick={() => { setDeity("mazu"); setStep(STEPS.INTRO); }}
                        >
                          <div className="flex items-center gap-4">
                            <div className="w-14 h-14 rounded-2xl bg-amber-100 grid place-items-center">
                              <span className="text-2xl font-bold text-red-900">媽</span>
                            </div>
                            <div>
                              <div className="text-xl font-bold text-yellow-100">天后宮</div>
                              <div className="text-sm text-yellow-200/70">天上聖母 ‧ 溫暖指引（60籤）</div>
                            </div>
                          </div>
                          <div className="mt-4 text-xs text-yellow-200/70 leading-relaxed">
                            適合：求平安、家運、人際與心境方向。
                          </div>
                        </button>

                        <button
                          className="group text-left p-5 rounded-2xl bg-amber-950/45 border border-amber-500/30 hover:bg-amber-950/60 transition shadow-[0_0_30px_rgba(202,138,4,0.22)]"
                          onClick={() => { setDeity("wts"); setStep(STEPS.INTRO); }}
                        >
                          <div className="flex items-center gap-4">
                            <div className="w-14 h-14 rounded-2xl bg-amber-100 grid place-items-center">
                              <span className="text-2xl font-bold text-amber-900">仙</span>
                            </div>
                            <div>
                              <div className="text-xl font-bold text-yellow-100">黃大仙祠</div>
                              <div className="text-sm text-yellow-200/70">有求必應 ‧ 玄機妙算（100籤）</div>
                            </div>
                          </div>
                          <div className="mt-4 text-xs text-yellow-200/70 leading-relaxed">
                            適合：求事業、取捨、時機與方向判斷。
                          </div>
                        </button>
                      </div>

                      <div className="text-xs text-yellow-200/60 leading-relaxed bg-white/5 border border-white/10 rounded-xl p-4">
                        <div className="font-bold text-yellow-100 mb-1">尊重提示</div>
                        本網站內容整理自民間流傳版本，僅供文化體驗與參考。敬請以虔誠與尊重之心使用。
                      </div>
                    </div>
                  )}

                  {step === STEPS.INTRO && deity && (
                    <div className="space-y-8 animate-fade-in">
                      <SectionTitle
                        icon="🙏"
                        title="誠心求籤"
                        subtitle="請依循傳統步驟，慢一點，感受一下儀式感。"
                      />
                      <div className="bg-black/25 border border-white/10 rounded-2xl p-5 text-sm text-gray-100 space-y-3">
                        <div className="font-bold text-yellow-100 flex items-center gap-2">
                          <span className="inline-flex w-6 h-6 rounded-full bg-yellow-600 text-stone-900 items-center justify-center text-xs font-bold">1</span>
                          稟報姓名與所問（一句話即可，避免過於私密的個資）
                        </div>
                        <div className="font-bold text-yellow-100 flex items-center gap-2">
                          <span className="inline-flex w-6 h-6 rounded-full bg-yellow-600 text-stone-900 items-center justify-center text-xs font-bold">2</span>
                          擲筊請示神明是否允諾賜籤
                        </div>
                        <div className="font-bold text-yellow-100 flex items-center gap-2">
                          <span className="inline-flex w-6 h-6 rounded-full bg-yellow-600 text-stone-900 items-center justify-center text-xs font-bold">3</span>
                          搖籤筒直到聖籤浮出
                        </div>
                        <div className="font-bold text-yellow-100 flex items-center gap-2">
                          <span className="inline-flex w-6 h-6 rounded-full bg-yellow-600 text-stone-900 items-center justify-center text-xs font-bold">4</span>
                          再擲筊確認此籤，最後再解籤
                        </div>

                        <div className="text-xs text-yellow-100/80 bg-white/5 border border-white/10 rounded-lg p-3 leading-relaxed">
                          本服務為線上體驗形式，模擬擲筊與抽籤流程。請以平常心參考；重要決定仍建議多方思考與求證。
                        </div>
                      </div>

                      <div className="flex justify-center">
                        <button
                          className="px-6 py-3 rounded-xl bg-yellow-500 hover:bg-yellow-400 text-stone-950 font-bold shadow-lg"
                          onClick={() => setStep(STEPS.INPUT)}
                        >
                          開始稟報
                        </button>
                      </div>
                    </div>
                  )}

                  {step === STEPS.INPUT && deity && (
                    <div className="space-y-6 animate-fade-in">
                      <SectionTitle icon="📝" title="稟報資料" subtitle="一句話描述重點即可。心意到，比長篇大論更重要。" />

                      <div className="space-y-4">
                        <div>
                          <label className="block text-sm text-yellow-200/80 mb-2">姓名</label>
                          <input
                            value={name}
                            onChange={(e) => setName(e.target.value.slice(0, 30))}
                            className="w-full px-4 py-3 rounded-xl bg-black/25 border border-yellow-600/30 text-white placeholder:text-white/40"
                            placeholder="請輸入您的姓名（可暱稱）"
                          />
                        </div>

                        <div>
                          <label className="block text-sm text-yellow-200/80 mb-2">所問事項</label>
                          <textarea
                            value={question}
                            onChange={(e) => setQuestion(e.target.value.slice(0, 120))}
                            rows={4}
                            className="w-full px-4 py-3 rounded-xl bg-black/25 border border-yellow-600/30 text-white placeholder:text-white/40 resize-none"
                            placeholder="例：想轉系到設計系，是否適合？（一句話即可）"
                          />
                          <div className="flex items-center justify-between mt-1 text-xs text-yellow-200/60">
                            <span>建議避免輸入過於私密的個資。</span>
                            <span>{question.length}/120</span>
                          </div>
                        </div>
                      </div>

                      <div className="flex justify-center gap-3">
                        <button
                          className="px-6 py-3 rounded-xl bg-yellow-500 hover:bg-yellow-400 text-stone-950 font-bold shadow-lg"
                          onClick={() => {
                            if (!question.trim()) {
                              setMessage("請先輸入所問事項（一句話即可）。");
                              return;
                            }
                            setMessage("");
                            setStep(STEPS.ASK_PERMISSION);
                          }}
                        >
                          資料稟報完畢
                        </button>
                      </div>
                      {message && <div className="text-center text-sm text-yellow-200/80">{message}</div>}
                    </div>
                  )}

                  {(step === STEPS.ASK_PERMISSION || step === STEPS.CONFIRM_LOT) && deity && (
                    <div className="space-y-6 animate-fade-in">
                      <SectionTitle
                        icon="🪙"
                        title={step === STEPS.ASK_PERMISSION ? "擲筊請示" : "再擲筊確認此籤"}
                        subtitle={step === STEPS.ASK_PERMISSION ? "請誠心擲筊，若得聖筊則可賜籤。" : "確認後再解籤，避免抽到不屬於此刻的籤。"}
                      />

                      <div className="flex items-center justify-center gap-10 py-4">
                        <MoonBlock type={leftBeiType} rotateClass={isTossing ? "animate-toss-left" : ""} />
                        <MoonBlock type={rightBeiType} rotateClass={isTossing ? "animate-toss-right" : ""} />
                      </div>

                      <div className="text-center space-y-2">
                        <div className="text-2xl font-bold text-yellow-100">{beiResult || "—"}</div>
                        {message && <div className="text-sm text-yellow-200/70">{message}</div>}
                        <div className="text-xs text-yellow-200/50">擲筊次數：{tossCount}</div>
                      </div>

                      <div className="flex justify-center gap-3 pt-2">
                        <button
                          className="px-6 py-3 rounded-xl bg-yellow-500 hover:bg-yellow-400 text-stone-950 font-bold shadow-lg disabled:opacity-50"
                          disabled={isTossing}
                          onClick={() => performToss(step === STEPS.ASK_PERMISSION ? "permission" : "confirm")}
                        >
                          擲筊
                        </button>

                        <button
                          className="px-5 py-3 rounded-xl bg-stone-900/40 border border-yellow-600/30 hover:bg-stone-900/60 text-yellow-100 font-bold"
                          disabled={isTossing}
                          onClick={() => resetAll(false)}
                        >
                          重問
                        </button>
                      </div>
                    </div>
                  )}

                  {step === STEPS.SHAKING && deity && (
                    <div className="space-y-6 animate-fade-in">
                      <SectionTitle icon="🎋" title="搖籤筒" subtitle="慢慢搖，讓心定下來。" />
                      <div className="flex justify-center">
                        <div className={cn("w-48 h-48 rounded-2xl border border-yellow-600/30 bg-black/20 grid place-items-center shadow-xl", isShaking && "animate-shake-hard")}>
                          <div className="text-center">
                            <div className="text-4xl mb-2">🧺</div>
                            <div className="text-sm text-yellow-100/80">{isShaking ? "搖籤中…" : "準備好了就開始"}</div>
                          </div>
                        </div>
                      </div>
                      <div className="flex justify-center gap-3">
                        <button
                          className="px-6 py-3 rounded-xl bg-yellow-500 hover:bg-yellow-400 text-stone-950 font-bold shadow-lg disabled:opacity-50"
                          disabled={isShaking}
                          onClick={() => {
                            setIsShaking(true);
                            setMessage("搖籤中…");
                            setTimeout(() => {
                              setIsShaking(false);
                              setMessage("");
                              setStep(STEPS.PICK_LOT);
                              pickLot();
                            }, 1100);
                          }}
                        >
                          開始搖籤
                        </button>
                      </div>
                      {message && <div className="text-center text-sm text-yellow-200/70">{message}</div>}
                    </div>
                  )}

                  {step === STEPS.AI_ANALYZING && deity && (
                    <div className="space-y-6 animate-fade-in">
                      <SectionTitle icon="🕯️" title="正在解籤" subtitle="心靜則籤明，稍候片刻。" />
                      <div className="flex justify-center">
                        <div className="px-4 py-3 rounded-xl bg-black/25 border border-white/10 text-yellow-100/80">
                          {message || "正在整理籤意…"}
                        </div>
                      </div>
                    </div>
                  )}

                  {step === STEPS.RESULT && deity && tempLot && guidanceText && (
                    <div className="space-y-6 animate-fade-in">
                      <SectionTitle icon="✨" title="籤詩結果" subtitle="先看籤詩，再看建議；詳細解釋可展開查看。" />

                      <div className="bg-[#fffbf0] text-stone-900 rounded-2xl border-4 border-red-800/60 overflow-hidden">
                        <div className="p-4 md:p-5 border-b border-stone-200">
                          <div className="flex items-center justify-between gap-3">
                            <div className="font-bold">
                              {deity === "mazu" ? `${tempLot.t}籤（第 ${tempLot.id} 籤）` : `第 ${tempLot.id} 籤`}
                            </div>
                            <div className={cn("px-3 py-1 rounded-full text-xs font-bold text-white", deity === "mazu" ? "bg-red-800" : "bg-amber-800")}>
                              {tempLot.l}
                            </div>
                          </div>
                          {tempLot.s && <div className="text-sm text-stone-600 mt-1">【{tempLot.s}】</div>}
                        </div>

                        <div className="p-4 md:p-5">
                          <div className="md:hidden space-y-2">
                            {(tempLot.p || []).map((line, i) => (
                              <div key={i} className="text-center font-bold text-stone-900 border border-stone-200 rounded-lg py-2 px-3 bg-white">
                                {line}
                              </div>
                            ))}
                          </div>

                          <div className="hidden md:flex justify-center">
                            <div className="flex flex-row-reverse gap-3">
                              {(tempLot.p || []).map((line, i) => (
                                <div key={i} className="writing-vertical font-bold text-stone-900 h-44 border-l border-stone-200 pl-2">
                                  {line}
                                </div>
                              ))}
                            </div>
                          </div>

                          <div className="mt-4 flex flex-wrap gap-2 justify-center">
                            <Pill>所問：{(question || "").trim() ? question.trim() : "未填"}</Pill>
                            <Pill>擲筊：{tossCount} 次</Pill>
                            <Pill>殿堂：{deityMeta?.title}</Pill>
                          </div>

                          <div className="mt-5">
                            <button
                              className="w-full px-4 py-3 rounded-xl bg-stone-900/5 hover:bg-stone-900/10 border border-stone-200 text-stone-900 font-bold flex items-center justify-between"
                              onClick={() => setShowDetails(v => !v)}
                            >
                              <span>查看籤解細項</span>
                              <span className="text-sm">{showDetails ? "收合" : "展開"}</span>
                            </button>
                            {showDetails && (
                              <div className="mt-3">
                                <DetailGrid />
                                <div className="mt-3 text-xs text-stone-500 leading-relaxed">
                                  提醒：各項解釋為傳統參考語彙，宜以你當下情境做合理對照。
                                </div>
                              </div>
                            )}
                          </div>

                          <div className="mt-5 bg-white/70 border border-stone-200 rounded-2xl p-4">
                            <div className="text-sm font-bold text-stone-900 mb-2">解籤建議（線上整理版）</div>
                            <div className="text-sm leading-relaxed whitespace-pre-line text-stone-900">{guidanceText}</div>
                          </div>
                        </div>
                      </div>

                      <div className="flex flex-col md:flex-row gap-3 justify-center">
                        <button
                          className="px-6 py-3 rounded-xl bg-yellow-500 hover:bg-yellow-400 text-stone-950 font-bold shadow-lg"
                          onClick={downloadImage}
                        >
                          保存結緣圖（PNG）
                        </button>
                        <button
                          className="px-6 py-3 rounded-xl bg-stone-900/40 border border-yellow-600/30 hover:bg-stone-900/60 text-yellow-100 font-bold"
                          onClick={() => resetAll(false)}
                        >
                          再問一題
                        </button>
                      </div>

                      <div className="text-xs text-yellow-200/60 leading-relaxed bg-white/5 border border-white/10 rounded-xl p-4">
                        <div className="font-bold text-yellow-100 mb-1">尊重提示</div>
                        本網站內容整理自民間流傳版本，僅供文化體驗與參考。敬請以虔誠與尊重之心使用；重要決策仍請結合現實條件與專業建議。
                      </div>

                      <canvas ref={canvasRef} className="hidden"></canvas>
                    </div>
                  )}

                </div>
              </div>

              <footer className="mt-6 text-center text-xs text-yellow-200/50">
                &copy; 線上靈籤 | V35_Improved（單檔 HTML / 內含 媽祖60籤 & 黃大仙100籤）
              </footer>
            </div>
          </main>
        </div>
      );
    }

    
    const mountNode = document.getElementById("root");
    try {
      // React 18 UMD: createRoot may exist on ReactDOMClient
      if (window.ReactDOMClient && typeof window.ReactDOMClient.createRoot === "function") {
        const root = window.ReactDOMClient.createRoot(mountNode);
        root.render(<App />);
      } else if (window.ReactDOM && typeof window.ReactDOM.createRoot === "function") {
        const root = window.ReactDOM.createRoot(mountNode);
        root.render(<App />);
      } else if (window.ReactDOM && typeof window.ReactDOM.render === "function") {
        window.ReactDOM.render(<App />, mountNode);
      } else {
        throw new Error("ReactDOM createRoot/render not found.");
      }
    } catch (e) {
      if (window.__APP_ERROR_OVERLAY__ && window.__APP_ERROR_OVERLAY__.show) {
        window.__APP_ERROR_OVERLAY__.show(e && e.stack ? e.stack : String(e));
      } else {
        console.error(e);
      }
    }
             </script>

  <script>
    (function () {
      function show(msg) {
        try {
          var el = document.getElementById("error-overlay");
          if (!el) {
            el = document.createElement("pre");
            el.id = "error-overlay";
            el.style.position = "fixed";
            el.style.left = "12px";
            el.style.right = "12px";
            el.style.bottom = "12px";
            el.style.maxHeight = "45vh";
            el.style.overflow = "auto";
            el.style.background = "rgba(0,0,0,0.85)";
            el.style.color = "#fde68a";
            el.style.padding = "12px";
            el.style.border = "1px solid rgba(245,158,11,0.4)";
            el.style.borderRadius = "12px";
            el.style.zIndex = 99999;
            el.style.whiteSpace = "pre-wrap";
            el.style.fontFamily = "ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace";
            document.body.appendChild(el);
          }
          el.textContent = "⚠️ 程式發生錯誤（開發提示）：\n\n" + msg + "\n\n建議：請確認網路可連到 unpkg CDN，或把頁面上傳到網站（非 file://）。";
        } catch (e) {}
      }
      window.__APP_ERROR_OVERLAY__ = { show: show };
      window.addEventListener("error", function (e) {
        show((e && (e.message || e.error && e.error.stack)) ? (e.message + "\n" + (e.error && e.error.stack ? e.error.stack : "")) : String(e));
      });
      window.addEventListener("unhandledrejection", function (e) {
        show(e && e.reason ? (e.reason.stack || String(e.reason)) : "Unhandled promise rejection");
      });
      // Warn if CDN scripts didn't load
      window.addEventListener("load", function () {
        if (!window.React || (!window.ReactDOM && !window.ReactDOMClient)) {
          show("React / ReactDOM CDN 載入失敗。");
        }
      });
    })();
  </script>
</body>
</html>

